<div class="modal-header" draggableModal>
    <label class="modal-title">New User</label>
    <button type="button" class="close" aria-label="Close" (click)="cancelForm()">
        <span aria-hidden="true">&times;</span>
    </button>
</div>
<form (keydown.enter)="$event.preventDefault()" #userForm="ngForm" [mustMatch]="['password', 'passwordConfirmation']">
    <div class="modal-body" [ngStyle]="{'height':(showHierarchy)?'75vh':'70vh' }">
        <div class="mycontainer">
            <!--   Name   -->
            <div class="form-group row">
                <div class="col">
                    <div class="form-group">
                        <label for="userName" class="form-label">Name:</label>
                        <input required type="text" name="userName" placeholder="Enter Name" class="form-control"
                               [(ngModel)]="user.name" id="userName" #userName="ngModel">
                    </div>
                </div>
            </div>
            <!--   Email ID   -->
            <div class="form-group row">
                <div class="col">
                    <div class="form-group">
                        <label for="userMail" class="form-label">Email ID:</label>
                        <input required pattern="^[A-Za-z0-9_.-]+@[0-9a-zA-Z_]+?\.[a-zA-Z]{2,3}$" type="email" name="userMail"
                               placeholder="Enter Email" class="form-control" [(ngModel)]="user.email" id="userMail"
                               #userMail="ngModel">
                        <!-- <label [hidden]="userMail.valid" class="invalid-message">Wrong Mail</label> -->
                    </div>
                </div>
            </div>
            <!--   Password   -->
            <div class="form-group row">
                <div class="col">
                    <div class="form-group">
                        <label for="password" class="form-label">Password:</label>
                        <input id="password" type="password" name="password" placeholder="Enter Password"
                               class="form-control" [(ngModel)]="user.password" #password="ngModel" required
                               minlength="6"
                               maxlength="10">
                        <div *ngIf="password.invalid && (password.dirty || password.touched)">
                            <div *ngIf="password.errors.minlength">
                                <label class="invalid-message">Password must contain at least 6 characters.</label>
                            </div>
                            <div *ngIf="password.errors.maxlength">
                                <label class="invalid-message">Password must contain less than 10 characters.</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--   Confirm Password   -->
            <div class="form-group row">
                <div class="col">
                    <div class="form-group">
                        <label for="passwordConfirmation" class="form-label">Confirm Password:</label>
                        <input id="passwordConfirmation" type="password" name="passwordConfirmation"
                               placeholder="Re-Enter Password" class="form-control"
                               [(ngModel)]="user.passwordConfirmation"
                               #passwordConfirmation="ngModel" required minlength="6" maxlength="10">
                        <div
                                *ngIf="passwordConfirmation.invalid && (passwordConfirmation.dirty || passwordConfirmation.touched)">
                            <div *ngIf="passwordConfirmation.errors.mustMatch">
                                <label class="invalid-message">Passwords didn't match.</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--  roles   -->
            <div class="form-group row">
                <div class="col">
                    <div class="form-group">
                        <label class="form-label">Role:</label>
                    
                            <ng-select [items]="roles" [virtualScroll]="true" class="form-control" placeholder="Select Role" 
                            bindLabel="name" style="height:auto !important;width:100%; border:1px solid #ccc;"
                            bindValue="id" name="role" [dropdownPosition] ="'bottom'" (change)="onSelectRole($event)"
                            [ngStyle]="{'border-left':(selectedRole != undefined )?'5px solid #42a948':'5px solid #BC2426'}" (open)="resizeBody('open');" (close)="resizeBody('close')" 
                            
                            [(ngModel)]="selectedRole">
                            </ng-select>
                    </div>
                </div>
            </div>
            <!-- hierarchy -->
            <div class="form-group row">
                <div class="col">
                    <div class="row">
                        <div class="col">
                            <label class="form-label">Hierarchy:</label>
                        </div>
                    </div>
                    <div class="form-group row">
                        <div class="col-sm-10">
                            <input class="form-control" type="text" name="hierarchyName" disabled
                                   [(ngModel)]="selectedHierarchy.name">
                        </div>
                        <div class="col-sm-1">
                            <button (click)="this.showHierarchy = !this.showHierarchy;"
                                    class="action-btn">{{(showHierarchy) ? 'Done' : 'Change'}}</button>
                        </div>
                    </div>
                </div>
            </div>
            <!-- hierarchy breadcrumb-->
            <div class="row" *ngIf="hierarchyBreadCrumbList.length>=3 && showHierarchy">
                <div>
                    <button (click)="onPreviousSearchPosition('rightEnd')" class="action-arrows">
                        <strong>{{'<<'}}</strong>
                    </button>
                    <button (click)="onPreviousSearchPosition('right')" class="action-arrows">
                        <strong>{{'<'}}</strong>
                    </button>
                </div>
                <div class="col-sm-9" id="panel">
                    <nav aria-label="breadcrumb" style="overflow: hidden;white-space: nowrap;height: 14vh;" #panel
                         (scroll)="onScroll()">
                        <ol class="breadcrumb" style="display: inline-block">
                            <li class="breadcrumb-item" style="font-size:14px;cursor: pointer;display: inline-block;"
                                [ngStyle]="{'font-weight':(i==hierarchyBreadCrumbList.length-1)?'500':'400'}"
                                *ngFor="let item of hierarchyBreadCrumbList;let i=index;"
                                (click)="onBreadCrumbAction(i)">
                                <a>{{(item?.name)}}</a></li>
                        </ol>
                        <ng-select *ngIf="hierarchyList.length>0" class="form-control custom" [items]="hierarchyList"
                                   bindLabel="nameAndType" bindValue="name" style="width: 50%;"
                                   name="hierarchy"
                                   (change)="onChangeHierarchy($event)"
                                   [(ngModel)]="selectedHierarchyName" [virtualScroll]="true"
                                   placeholder="Select Hierarchy">
                            <!-- tool tip -->
                            <ng-template ng-option-tmp let-item="item">
                                <div title="{{item.nameAndType}}">{{item.nameAndType}}</div>
                            </ng-template>
                        </ng-select>
                    </nav>
                </div>
                <div>
                    <button (click)="onNextSearchPosition('left')" class="action-arrows">
                        <strong>{{'>'}}</strong>
                    </button>
                    <button (click)="onNextSearchPosition('leftEnd')" class="action-arrows">
                        <strong>{{'>>'}}</strong>
                    </button>
                </div>
            </div>
            <div class="row" *ngIf="hierarchyBreadCrumbList.length<3 && showHierarchy">
                <nav aria-label="breadcrumb" #panel style="width: 100%;height: 10vh;">
                    <ol class="breadcrumb" style="display: inline-block;">
                        <li class="breadcrumb-item" style="font-size:14px;cursor: pointer;display: inline-block;"
                            [ngStyle]="{'font-weight':(i==hierarchyBreadCrumbList.length-1)?'500':'400'}"
                            *ngFor="let item of hierarchyBreadCrumbList;let i=index;" (click)="onBreadCrumbAction(i)">
                            <a>{{item.name}}</a></li>
                    </ol>
                    <ng-select *ngIf="hierarchyList.length>0" class="form-control custom" [items]="hierarchyList"
                               name="hierarchy" bindLabel="nameAndType" bindValue="name"
                               style="width: 30%;display: inline-block;" (change)="onChangeHierarchy($event)"
                               [(ngModel)]="selectedHierarchyName"
                               [virtualScroll]="true" placeholder="Select Hierarchy">
                        <!-- tool tip -->
                        <ng-template ng-option-tmp let-item="item">
                            <div title="{{item.nameAndType}}">{{item.nameAndType}}</div>
                        </ng-template>
                    </ng-select>
                </nav>
            </div>
            <!--<div class="form-group row">
                &lt;!&ndash;   Admin   &ndash;&gt;
                <div class="col-3">
                    <div class="form-group">
                        <label for="admin" class="form-label">Admin</label> &nbsp;
                        <input type="checkbox" [(ngModel)]="user.isAdmin" name="admin" id="admin" #admin="ngModel"
                               (change)="onSelectAdmin()">
                    </div>
                </div>
                &lt;!&ndash;   User   &ndash;&gt;
                <div class="col-3">
                    <div class="form-group">
                        <label for="admin" class="form-label">User</label> &nbsp;
                        <input type="checkbox" [(ngModel)]="user.isUser" name="user" id="user" #admin="ngModel"
                               (change)="onSelectUser()">
                    </div>
                </div>
                <div class="col-6" *ngIf="!user.isAdmin">
                    <div class="form-group" style="margin-top: -2px;">
                        <label *ngIf="!enabledPermissions" class="form-label">Enable Permissions&nbsp;</label>
                        <button *ngIf="!enabledPermissions" style="margin-left:1.5px;" class="plus-btn"
                                (click)=showPermissions()><i class="fa fa-plus" aria-hidden="true"
                                                             style="color: #7694B7;"></i></button>

                        <label *ngIf="enabledPermissions" class="form-label">Hide Permissions&nbsp;</label>
                        <button *ngIf="enabledPermissions" class="plus-btn" (click)=showPermissions()><i
                                class="fa fa-minus" aria-hidden="true" style="color: #7694B7;"></i></button>
                    </div>
                </div>
            </div>-->
        </div>
        <!--   Admin permission     -->
        <!--<div class="permissions" *ngIf="enabledPermissions && !user.isAdmin && !user.isUser">
            <div class="form-group row">
                <table>
                    <thead class="modal-table">
                    <th>Action</th>
                    <th>Create</th>
                    <th>Modify</th>
                    <th>Delete</th>
                    <th>Read</th>
                    </thead>
                    <tbody class="modal-table">
                    <tr *ngFor="let permission of permissions" class="modal-table">
                        <td style="text-align:left !important;">{{permission.name}}</td>
                        <td *ngFor="let value of permission.permissions;let i = index">
                            <input [disabled]="value.value.includes('READONLY')" type="checkbox"
                                   [(ngModel)]="value.enabled" name="permission_{{value.value}}"
                                   id="permission_{{value.value}}" #permission_{{value.value}}="ngModel"
                                   (change)="verify(permission);">
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>-->
        <!-- Hierarchy dropdown -->
        <!--
                <div style="display: block" *ngIf="user.isUser && enabledPermissions">
                    <div class="row form-group">
                        <div class="col-2">
                            <label style="margin-top: 10px;" for="admin" class="form-label">Hierarchy</label> &nbsp;
                        </div>
                        <div class="col-10">
                            <ng-select class="form-control custom" [items]="hierarchyList"
                                       bindLabel="name" bindValue="value"
                                       [multiple]="true"
                                       (change)="onChangeHierarchy($event)"
                                       [virtualScroll]="true" placeholder="Select Hierarchy">
                            </ng-select>
                        </div>
                    </div>
                </div>
                <br *ngIf="selectedHierarchy.length>7">
        -->
        <!--<div class="form-group row" *ngIf="user.isUser && enabledPermissions">
            <label class="form-label" [title]="hierarchyTitle"
                   style="font-weight: bold;margin-left: 40%;">Hierarchy</label>
        </div>
        <div class="form-group" *ngIf="user.isUser && enabledPermissions">
            <label for="uName" class="form-label">User Name:</label>
            <input type="text" name="uName" placeholder="Enter User Name" class="form-control"
                   [(ngModel)]="user.hierarchyUserName" id="uName" #userName="ngModel">
        </div>
        <div class="form-group" *ngIf="user.isUser && enabledPermissions">
            <label for="pwd" class="form-label">Password:</label>
            <input type="password" name="pwd" placeholder="Enter Password" class="form-control"
                   [(ngModel)]="user.hierarchyPassword" id="pwd" #pwd="ngModel">
        </div>
        &lt;!&ndash;   User permission   &ndash;&gt;
        <div class="permissions" *ngIf="user.isUser && enabledPermissions">
            <div class="row form-group">
                <table>
                    <tbody class="modal-table">
                    <tr style="font-weight: bold;">Management Actions</tr>
                    <tr *ngFor="let item of userPermissions[0]['actions']" class="modal-table">
                        <td style="text-align:left !important;">{{item.name}}</td>
                        <td>
                            <input type="checkbox" [(ngModel)]="item.enabled"
                                   id="createManagementPermission_{{item.value}}"
                                   name="createManagementPermission_{{item.value}}">
                        </td>
                    </tr>
                    <tr style="font-weight: bold;">License Management</tr>
                    <tr *ngFor="let item of userPermissions[1]['actions']" class="modal-table">
                        <td style="text-align:left !important;">{{item.name}}</td>
                        <td>
                            <input type="checkbox" [(ngModel)]="item.enabled" id="permission_{{item.value}}"
                                   name="permission_{{item.value}}">
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>-->
    </div>
    <div class="modal-footer">
        <button (click)="cancelForm()" class="modal-cancel-btn">
            Cancel
        </button>
        <button class="modal-scs-btn" (click)="createUser()" [disabled]="!userForm.form.valid"
                (keydown.enter)="$event.preventDefault()">
            Create
        </button>
    </div>
</form>
