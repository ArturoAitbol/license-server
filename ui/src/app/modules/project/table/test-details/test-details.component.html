<table class="master-table strip-table">
    <tbody class="master-body">
        <tr *ngFor="let test of tests">
            <td [width]="getColumnWidth(detailColumns[0])" style="text-align:left;" title="{{test.index}}">
                <label class="regular-text index" style="cursor: pointer;" (click)="editTestScript(test)">{{test.index}}</label>
            </td>
            <td [width]="getColumnWidth(detailColumns[1])">
                <label *ngIf="test.status !== 'RUNNING'" class="report-text" [style.color]="statusColor(test.status)" (click)="showReport(template, test)">
                    <span *ngIf="test.status.toLowerCase() !=='passed*'">{{test.status | titlecase}}</span>
                    <span *ngIf="test.status.toLowerCase() ==='passed*'"
                        [style.color]="statusColor('passed')">{{'Passed'}}</span>
                    <span *ngIf="test.status.toLowerCase() ==='passed*'"
                        [style.color]="statusColor('failed')">{{'*'}}</span>
                </label>
                <img class="loading" *ngIf="test.status.toLowerCase() === 'running'" src="assets/images/loading.gif" alt="Loading">
            </td>
            <!-- <td [width]="getColumnWidth(detailColumns[2])" class="regular-text">{{test.startDate | date:'medium'}}</td> -->
            <td [width]="getColumnWidth(detailColumns[2])" class="regular-text">{{test.startDateString}}</td>
            <td [width]="getColumnWidth(detailColumns[3])" class="regular-text">{{test.endDateString}}</td>
            <!-- <td [width]="getColumnWidth(detailColumns[3])" class="regular-text">{{test.endDate | date:'medium'}}</td> -->
            <td [width]="getColumnWidth(detailColumns[4])">
                <button class="btn-details" *ngIf="!this.executionStatus.includes(test.status.toLowerCase())" (click)="downloadLog(test)">Download Logs
                </button>
            </td>
        </tr>
    </tbody>
</table>

<ng-template #template>
    <div class="modal-header" draggableModal>
        <label class="modal-title">{{currentDetail.index }}</label>
        <button type="button" class="close" aria-label="Close" (click)="hideModal()">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <div class="modal-body" style="padding-bottom: 30px">
        <div class="row">
            <div class="col-md-5">
                <label class="status" style="font-weight:bold;font-size: 15px;">Execution Result:
                </label> &nbsp; <label class="status" [style.color]="statusColor(currentDetail.status)">{{currentDetail.status | titlecase}}</label>
            </div>
            <div class="col-md-5">
            </div>
            <div class="col-md-1">
                <button class="btn-logs" [disabled]="disabledDownloadButton" (click)="downloadLog(currentTest);">Logs
                </button>
            </div>
        </div>
        <div class="row" style="margin-left: 0px;margin-top: 15px;">
            <div class="col-lg-2" style="background: #C2C3C6">
                <label class="opt-title">Start Time</label><br>
            </div>
            <div class="col-lg-2" style="background: #F1F0F0">
                <label class="opt-title">End Time</label><br>
            </div>
            <div class="col-lg-2" style="background: #C2C3C6">
                <label class="opt-title">Calling #</label><br>
            </div>
            <div class="col-lg-2" style="background: #F1F0F0">
                <label class="opt-title">Called #</label><br>
            </div>
            <div class="col-lg-2" *ngIf="currentDetail.conferenceParties.length > 0" style="background: #C2C3C6">
                <label class="opt-title">Conferencing</label><br>
            </div>
            <div class="col-lg-2" *ngIf="currentDetail.transferees.length > 0" style="background: #F1F0F0">
                <label class=" opt-title">Transferee</label><br>
            </div>
        </div>
        <div class="row" style="margin-left: 0px;">
            <div class="col-lg-2" style="background: #C2C3C6">
                <!-- <label class="opt-value">{{currentDetail.startDate | date: 'dd/MM/yyyy HH:mm'}}</label> -->
                <label class="opt-value" style="max-width:140px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">{{currentDetail.startDateString }}</label>
            </div>
            <div class="col-lg-2" style="background: #F1F0F0">
                <!-- <label class="opt-value">{{currentDetail.endDate | date: 'dd/MM/yyyy HH:mm'}}</label> -->
                <label class="opt-value" style="max-width:140px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">{{currentDetail.endDateString}}</label>

            </div>
            <div class="col-lg-2" style="background: #C2C3C6">
                <label class="opt-value" style="max-width:140px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="{{currentDetail.callingNumber}}">{{currentDetail.callingNumber}}</label>
            </div>
            <div class="col-lg-2" style="background: #F1F0F0">
                <label class="opt-value" style="max-width:140px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="{{currentDetail.calledNumber}}">{{currentDetail.calledNumber}}</label>
            </div>
            <div class="col-lg-2" style="background: #C2C3C6" *ngIf="currentDetail.conferenceParties.length > 0">
                <label class="opt-value" *ngFor="let item of currentDetail.conferenceParties">
                    {{item}}
                </label>
            </div>
            <div class="col-lg-2" style="background: #F1F0F0" *ngIf="currentDetail.transferees.length > 0">
                <label class="opt-value" *ngFor="let item of currentDetail.transferees">
                    {{item}}
                </label>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12">
                <div class="actions-list">
                    <data-table [columnDefs]="stepColumns" [data]="(currentDetail.resources == null || currentDetail.resources.length==0) ?phoneDetails:currentDetail.resources" [selectedHeight]="'200px'" [colsTag]="'test-details'">
                        <tableRow>
                            <ng-template let-item="item" class="templateClass">
                                <tr class="strip-table">
                                    <td class="regular-text" style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" [width]="getStepsWidth(stepColumns[0])">
                                        {{(currentDetail.resources == null || currentDetail.resources.length == 0) ? item?.phoneTag : item?.id}}
                                    </td>
                                    <td class="regular-text" style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" [width]="getStepsWidth(stepColumns[1])">{{item?.macAddress}}</td>
                                    <td class="regular-text" style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" [width]="getStepsWidth(stepColumns[2])">{{item?.ipAddress}}</td>
                                    <td class="regular-text" style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" [width]="getStepsWidth(stepColumns[3])">{{item?.primaryUser}}</td>
                                    <td class="regular-text" style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" [width]="getStepsWidth(stepColumns[4])">
                                        {{(currentDetail.resources == null || currentDetail.resources.length == 0) ? item?.primaryExtn : item?.primaryExtension}}
                                    </td>
                                    <td class="regular-text" style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" [width]="getStepsWidth(stepColumns[5])">
                                        {{item?.email}}
                                    </td>
                                </tr>
                            </ng-template>
                        </tableRow>
                    </data-table>
                </div>
            </div>
        </div>
        <!--   MOS SCORE     -->
        <div *ngIf="mosScoreValues.length>0">
            <!-- <div class="row">
                <div class="col-6" *ngFor="let item of mosScoreValues;">
                    <label style="font-size: 14px;font-weight: bold">
                        {{item.name}}
                    </label> &nbsp;&nbsp;
                    <label style="font-size: 12px;">{{item.label}}</label>
                    <br>
                    <progressbar style="height: 10px !important;font-size: 8px;" [max]="MAX_VALUE" class="customClass" [value]="item.value" [striped]="false" [animate]="false">
                        <i style="color: black">
                            {{item.value}}
                        </i>
                    </progressbar>
                </div>
            </div> -->
            <br *ngIf="mosScoreDetailsList.length>0">
            <div class="row" *ngIf="mosScoreDetailsList.length>0">
                <div class="col-6">
                    <button class="btn-details" *ngIf="!_showCallStats" (click)="viewOrCloseMediaStats()">View Media Stats</button>
                    <button class="btn-details" *ngIf="_showCallStats" (click)="viewOrCloseMediaStats()">Close Media Stats</button>
                </div>
            </div>
            <!-- <br *ngIf="_showCallStats"> -->
            <div class="row" *ngIf="_showCallStats">
              <!-- <div class="col-lg-2 table-responsive table-nowrap">
                    <table id="callStatsVariable" class="table">
                        <thead style="width:100%; border: 0;">
                            <tr>
                                <th class="boundary"> Name </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let action of mosScoreDetailsList">
                                <td [title]="action.name" style="text-align: left !important;">
                                    {{action.name}}
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>  -->
                <div class="col-lg-12 table-responsive text-nowrap">
                                <div class="row pl-4 pr-4" *ngFor="let action of mosScoreDetailsList">
                                    <div class="col-sm-1 pt-1 pb-1 ">
                                        <span class="status" style="font-weight:bold;font-size: 15px;"> Name : {{action.name}}</span>
                                    </div>
                                    <div class="col-sm-11"></div>
                                    <br>
                                    <div class="col-sm-4"  style="border-bottom: 1px solid #d6dfe9;" *ngFor="let item of action['mosScoreKeyalueArray'];" >
                                        <div class="row"  >
                                            <div class="col-sm-6 " style="background: #C2C3C6; overflow: hidden;
                                            text-overflow: ellipsis;
                                            vertical-align: middle;">
                                               <span class="action-space"> {{item.label}}</span>
                                            </div>
                                            <div class="col-sm-6" style="background: #F1F0F0; overflow: hidden;
                                            text-overflow: ellipsis;
                                            vertical-align: middle;">
                                                <span>{{item.value | blank}}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>    
                    <!-- <table id="callStats" class="table">
                        <thead style="width:100%; border: 0;">
                            <tr style="display: flex;">
                                <th class="boundary" [title]="action.label" *ngFor="let action of mosScoreDetailsList[0]['mosScoreKeyalueArray'];">
                                    {{action.label}}
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr style="display: flex;" *ngFor="let action of mosScoreDetailsList">
                                <td [title]=" item.value" *ngFor="let item of action.mosScoreKeyalueArray">
                                    {{item.value | blank}}
                                </td>
                            </tr>
                        </tbody>
                    </table> -->
                    <!-- </div> -->
                </div>
                <!-- <div class="col-12">
                    <table class="table inner-table">
                        <thead>
                            <th>MOS-LQ</th>
                            <th>MOS-CQ</th>
                        </thead>
                        <tbody style="max-height: 270px;">
                            <tr style="table-layout: fixed">
                                <td *ngFor="let action of mosScoreDetailsList" class="regular-text" width="20%">
                                    {{action.value}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div> -->
            </div>
        </div>
        <!--  Test Case Steps -->
        <div class="row" *ngIf="currentDetail.actionReportDtos.length > 0" style="margin-top: 15px;">
            <div class="col-md-3">
                <label class="status" style="font-weight:bold;font-size: 15px;">Test Case Steps</label>
            </div>
        </div>
        <div class="row" *ngIf="currentDetail.actionReportDtos.length > 0">
            <div class="col-md-12">
                <div class="actions-list">
                    <table class="table strip-table inner-table">
                        <tbody style="max-height: 270px;">
                            <tr *ngFor="let action of currentDetail.actionReportDtos" style="table-layout: fixed">
                                <td class="regular-text" style="text-align: left !important; width: 10%;">
                                    {{action.action}}</td>
                                <td class="regular-text" style="text-align:left;overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" width="70%" title="{{action.description}}">
                                    {{action.description}}</td>
                                <td class="regular-text" width="20%" [style.color]="getColor(action.result)">
                                    {{action.result}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="row" style="margin-top:15px;">
            <div class="col-md-12">
                <label class="status" style="font-size: 15px;font-weight: bold;">Logs</label><br>
                <textarea [(ngModel)]="logAsText" disabled class="logs-area"></textarea>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <button class="modal-scs-btn" (click)="hideModal()">
            OK
        </button>
    </div>
</ng-template>

<ng-template #popConf>
    <div class="col-splitter">
        <label *ngFor="let item of currentDetail.conferenceParties">
            {{item}}
        </label>
    </div>
</ng-template>

<ng-template #popTrans>
    <div class="col-splitter">
        <label *ngFor="let item of currentDetail.transferees">
            {{item}}
        </label>
    </div>
</ng-template>