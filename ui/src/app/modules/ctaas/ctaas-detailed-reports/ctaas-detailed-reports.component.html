<div class="container-fluid">
    <ng-container *ngIf="hasDashboardDetails; then reportView; else blankView"></ng-container>
</div>
<!-- blank view -->
<ng-template #blankView>
    <div class="jumbotron d-flex align-items-center bg-transparent text-center">
        <div class="container">
            <app-loading-spinner [visible]="isLoadingResults" [message]="messageSpinner"></app-loading-spinner>
            <h2 *ngIf="!isLoadingResults">
                Failed to load the detailed test report. Please reach out to TekVizion support.
            </h2>
        </div>
    </div>
</ng-template>
<!-- report view -->
<ng-template #reportView>
    <mat-tab-group (selectedTabChange)="changeSelectedTab($event)"  [selectedIndex]="selectedTab" dynamicHeight mat-stretch-tabs="false" mat-align-tabs="start" preserveContent>
        <mat-tab label="REPORT" [disabled]="!displayStats">
            <div class="row mt-3">
                <div class="col-8">
                    <h1 class="text-start text-s" id="title">{{title}}</h1>
                    <h2 class="text-start text-s2" *ngIf="sectionFailed && status!==''" id="subtitle">Status: {{status}}</h2>
                    <h2 class="text-start text-s2" *ngIf="!sectionFailed" id="subtitle">Status:
                        <mat-button-toggle-group class="center-toggle" name="favoriteColor" aria-label="Favorite Color">
                            <mat-button-toggle [checked]="!failedIsChecked" (click)="getAll()" value="green">All</mat-button-toggle>
                            <mat-button-toggle [checked]="failedIsChecked" (click)="getFailed()"value="blue">Failed</mat-button-toggle>
                        </mat-button-toggle-group>
                    </h2>
                </div>
                <div class="col-4 text-right">
                    <button mat-raised-button [disabled]="canDisableDownloadBtn" (click)="isConfirmationRequired()">
                        Download Report
                        <mat-icon>download</mat-icon>
                    </button>
                </div>
            </div>
            <div class="hint">
                <mat-icon>info_outline</mat-icon>
                <div>All results are displayed in UTC</div>
            </div>
            <div class="row">
                <div class="col-4 table-max-size">
                    <h1 class="text-start font-s">Summary</h1>
                    <div id="summary-table" >
                        <mat-card class="card summary">
                            <mat-card-content class="summary-card-content">
                                <table class="table table-hover">
                                    <tbody>
                                        <tr *ngFor="let item of summaryDisplayedColumns">
                                            <th>{{item.header}}</th>
                                            <td id="{{item.header}}">{{reportResponse?.summary[item.value] | na}}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </mat-card-content>
                        </mat-card>
                    </div>
                </div>
                <div class="col-8 table-max-size">
                    <h1 class="text-start font-s">Endpoint Resources</h1>
                    <section class="table-section">
                        <mat-card class="card">
                            <mat-card-content [style.max-height.px]="tableMaxHeight">
                                <div id="endpoint-resources-table">
                                    <app-data-table id="{{title}} Endpoint Resources" class="table-container mat-elevation-z8" [tableData]="reportResponse.endpoints"
                                    [isLoadingResults]="isLoadingResults" [isRequestCompleted]="isRequestCompleted"
                                    [tableColumns]="endpointDisplayedColumns" (sort)="sortData($event)"></app-data-table>
                                </div>
                                </mat-card-content>
                        </mat-card>
                    </section>
                </div>
            </div>
            <br>
            <ng-container *ngIf="reportResponse then viewTestDetailedReport;"></ng-container>
        </mat-tab>
        <mat-tab label="STATS" *ngIf="displayStats">
            <app-polqa-trends *ngIf="polqaTrendsData && !isLoadingResults" [data]="polqaTrendsData" [groupBy]="groupBy"></app-polqa-trends>
            <div *ngIf="isPolqaTrendsLoading" class="d-flex justify-content-center mt-3">
                <img class="spinner" height="80" width="80" src="assets/images/spinner.gif" alt="loading spinner gif">
            </div>
        </mat-tab>
    </mat-tab-group>
</ng-template>
<ng-template #viewTestDetailedReport>
    <section class="table-section">
        <mat-card class="card" style="height: 400px;overflow: auto;">
            <div class="panel-title-container">
                <mat-card-content id ="{{title}} Details" class="row">
                <div>
                    <ng-container class="column-content" *ngIf="detailedTestReport.length > 0" >
                        <div class="fix-header">
                            <mat-accordion class="accordian-container">
                                <mat-expansion-panel hideToggle disabled style="background-color: #e4e5e5;">
                                    <mat-expansion-panel-header>
                                        <mat-panel-title  id = "Test Case Column" class="col-12 col-lg-2 col-md-2 col-sm-2 custom-col" style="color: black;font-weight: 500;" (click)="handleSort('testCaseName')"> Test Case
                                            <mat-icon class="small-icon" *ngIf="sortColumn === 'testCaseName'">{{ sortAscending ? 'arrow_upward' : 'arrow_downward' }}</mat-icon>
                                        </mat-panel-title>
                                        <mat-panel-title id = "Start Date Column" class="col-12 col-lg-2 col-md-2 col-sm-2 custom-col" style="color: black;font-weight: 500;" (click)="handleSort('startTime')"> Start Date
                                            <mat-icon class="small-icon" *ngIf="sortColumn === 'startTime'">{{ sortAscending ? 'arrow_upward' : 'arrow_downward' }}</mat-icon>
                                        </mat-panel-title>
                                        <mat-panel-title id = "From Column" class="col-12 col-xl-1 col-lg-2 col-md-1 col-sm-2 custom-col" style="color: black;font-weight: 500" (click)="handleSort('from')"> From
                                            <mat-icon class="small-icon" *ngIf="sortColumn === 'from'">{{ sortAscending ? 'arrow_upward' : 'arrow_downward' }}</mat-icon>
                                        </mat-panel-title>
                                        <mat-panel-title id = "From POLQA Column" class="col-12 col-xl-1 col-lg-2 col-md-2 col-sm-2 custom-col" style="color: black;font-weight: 500;" (click)="handleSort('fromPolqaAvg')"> From POLQA
                                            <mat-icon class="small-icon" *ngIf="sortColumn === 'fromPolqaAvg'">{{ sortAscending ? 'arrow_upward' : 'arrow_downward' }}</mat-icon>
                                        </mat-panel-title>
                                        <mat-panel-title id = "To Column" class="col-12 col-xl-1 col-lg-2 col-md-1 col-sm-2 custom-col" style="color: black;font-weight: 500" (click)="handleSort('to')"> To
                                            <mat-icon class="small-icon" *ngIf="sortColumn === 'to'">{{ sortAscending ? 'arrow_upward' : 'arrow_downward' }}</mat-icon>
                                        </mat-panel-title>
                                        <mat-panel-title id = "To POLQA Column" class="col-12 col-xl-1 col-lg-2 col-md-2 col-sm-2 custom-col" style="color: black;font-weight: 500;" (click)="handleSort('toPolqaAvg')"> To POLQA
                                            <mat-icon class="small-icon" *ngIf="sortColumn === 'toPolqaAvg'">{{ sortAscending ? 'arrow_upward' : 'arrow_downward' }}</mat-icon>
                                        </mat-panel-title>
                                        <mat-panel-title id = "Status Column" class="col-12 col-lg-1 col-md-1 col-sm-1 custom-col" style="color: black;font-weight: 500;" (click)="handleSort('status')"> Status
                                            <mat-icon class="small-icon" *ngIf="sortColumn === 'status'">{{ sortAscending ? 'arrow_upward' : 'arrow_downward' }}</mat-icon>
                                        </mat-panel-title>
                                        <mat-panel-title id = "Call Type Column" class="col-12 col-xl-1 col-lg-1 col-md-1 col-sm-1 custom-col" style="color: black;font-weight: 500;" (click)="handleSort('callType')"> Call Type
                                            <mat-icon class="small-icon" *ngIf="sortColumn === 'callType'">{{ sortAscending ? 'arrow_upward' : 'arrow_downward' }}</mat-icon>
                                        </mat-panel-title>
                                    </mat-expansion-panel-header>
                                </mat-expansion-panel>
                            </mat-accordion>
                        </div>
                        <mat-accordion *ngFor="let item of detailedTestReport; let i = index"
                            class="accordian-container">
                            <mat-expansion-panel (opened)="open(i)" (closed)="close(i)" hideToggle>
                                <mat-expansion-panel-header [style.background-color] = "item.color" (mouseover)="item.color = item.colorOnMouseOver"
                                (mouseout)="item.color = item.colorOnMouseOut"class="text-container">
                                    <mat-panel-title class="col-12 col-lg-2 col-md-2 col-sm-2 custom-col">
                                        <span class="testcasename" [title]="item.testCaseName">
                                            {{item.testCaseName | na}}
                                        </span>
                                    </mat-panel-title>
                                    <mat-panel-title [title]="item.startTime" class="col-12 col-lg-2 col-md-2 col-sm-1 custom-col">
                                        {{item.startTime | na}}
                                    </mat-panel-title>
                                    <mat-panel-title [title]="item.from?.DID" class="col-12 col-xl-1 col-lg-2 col-md-1 col-sm-2 custom-col">
                                        {{item.from?.DID | na}}
                                    </mat-panel-title>
                                    <mat-panel-title [title]="'AVGFrom'" class="average-col col-xl-1 col-12 col-lg-2 col-md-2 col-sm-2 custom-col">
                                        Min:{{item.fromPolqaMin | number:'.2' | na }}, Avg:{{item.fromPolqaAvg | number:'.2' | na }}
                                    </mat-panel-title>
                                    <mat-panel-title [title]="item.to?.DID" class="col-12 col-xl-1 col-lg-2 col-md-1 col-sm-2 custom-col">
                                        {{item.to?.DID | na}}
                                    </mat-panel-title>
                                    <mat-panel-title [title]="'AVGTo'" class="average-col col-12 col-xl-1 col-lg-2 col-md-2 col-sm-2 custom-col">
                                        Min:{{item.toPolqaMin | number:'.2' | na }}, Avg:{{item.toPolqaAvg | number:'.2' | na }}
                                    </mat-panel-title>
                                    <mat-panel-title [title]="item.status" class="col-12 col-lg-1 col-md-1 col-sm-1 custom-col">
                                        {{item.status | na}}
                                    </mat-panel-title>
                                    <mat-panel-title [title]="item.callType" class="col-12 col-xl-1 col-lg-1 col-md-1 col-sm-1 custom-col">
                                        {{item.callType | na}}
                                    </mat-panel-title>
                                        <mat-icon [matMenuTriggerFor]="menu" title="{{item.testCaseName}} drop-button" class="arrow-button col-12 col-lg-1 col-md-1 col-sm-1 col-xs-1 custom-col">
                                            more_vert</mat-icon>
                                        <mat-menu #menu="matMenu">
                                            <button mat-menu-item (click)="openDetails(item)">More Info</button>
                                        </mat-menu>
                                </mat-expansion-panel-header>
                            </mat-expansion-panel>
                        </mat-accordion>
                    </ng-container>
                    <h3 class="no-data-found" *ngIf="detailedTestReport.length === 0">No Data to display</h3>
                </div>
            </mat-card-content>
        </div>
        </mat-card>
    </section>
</ng-template>

<ng-template #noMediaStats>
    <h3 class=" text-center">{{NO_MEDIA_STATS_MSG}}</h3>
</ng-template>